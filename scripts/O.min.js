(function(b){var c={progressBar:'<img src="/graphics/en/UI/progress_bar_large_green.gif" style="margin-bottom: 15px;" class="progressBar" />',watchBtn:'<a class="UIButton large grey watch" title="Add this person to your watchlist"><span class="UIIcon px16 watchlist"></span><span class="UIButtonTxt">Watch</span></a>',watchStatusWatching:"<div class='watchStatus'><span class='UIIcon px16 tick'></span>Watching</div>",jelloonAffirm:'<div class="jelloon affirmative" id="jelloonAffirm" style="z-index:10;" onclick="$(this).fadeOut();">text</div>',jelloonNeg:'<div class="jelloon negative" id="jelloonNeg"  style="z-index:10;" onclick="$(this).fadeOut();">text</div>',scape:{create:function(){var d=c.processInput(scapePublisher.getEditorHTML(),"scape");var e=b("#headingBox").val();if(c.hasText(d,true)||e!=""){c.animate.lockPub();b.ajax({type:"POST",url:"/logged/ajax/createscape",data:"scape="+encodeURIComponent(d)+"&title="+encodeURIComponent(e),error:function(){c.animate.displayScapeError()},success:function(h){var g=b.parseJSON(h);var f=g.scapeid;if(f.match(/^\d*$/)&&f!=""){if(d!=""||e!=""){c.scape.get(f);c.animate.unlockPub(false,"scape")}}else{c.animate.displayScapeError()}}})}},get:function(d){b.ajax({type:"POST",url:"/logged/ajax/updatetimeline",data:"scapeid="+d,success:function(e){c.animate.displayPostedScape(e)}})},load:function(d,e,f){if(!c.noMoreScapes){b("#loadMoreBtn").hide();b("#timelineFeed").append(c.progressBar);b.ajax({type:"POST",url:"/logged/ajax/displaytimeline",data:"location="+d+"&userid="+e+"&loadMore="+f,success:function(g){if(g==""){c.noMoreScapes=true;b("#loadMoreBtn").remove()}c.animate.displayNewLoadedScapes(g)}})}},edit:function(){var h=b(".CGPost").attr("id").replace(/S/,"");if(!c.scapeContentOri){c.scapeContentOri=b("#scapeContent").html();c.emoToText(h,"scape")}if(!c.edit){c.edit=1}else{c.edit=null}var g=c.processInput(b("#scapeContent").html(),"scape");var f=b("#postTitle").html();var e=b.trim(b("#headingBox").val());var d=c.processInput(scapeEditor.getEditorHTML(),"scape");if(e=="Add a title..."){e=""}if(c.edit){c.animate.editScape(g,f,"edit");b("#headingBox").focus()}else{if(d.replace(/(<[^img].*?>)|(&nbsp;)/ig,"").replace(/\s/g,"")==""){b("#editEditor").html("")}if(!c.hasText(d,true)&&e!=""||c.hasText(d,true)&&e==""||c.hasText(d,true)&&e!=""){b.ajax({type:"POST",url:"/logged/ajax/editscape/format/xml",data:"scape="+encodeURIComponent(d)+"&title="+encodeURIComponent(e)+"&scapeid="+h,success:function(){c.animate.editScape(c.textToEmo(d),e,"done_change");c.scapeContentOri=null}})}else{c.animate.editScape(c.scapeContentOri,f,"done_nochange");c.scapeContentOri=null}}},deleteScape:function(e,d){b.ajax({type:"POST",url:"/logged/ajax/delete",data:"elmid="+e+"&idType=scape",success:function(){if(d){var f="/index";b(location).attr("href",f)}else{b("#S"+e).slideUp("slow",function(){b("#S"+e).remove()})}}})}},reply:{create:function(){var e,d;e=c.processInput(replyPublisher.getEditorHTML(),"reply");d=b(".CGPost").attr("id").replace(/S/,"");if(c.hasText(e)){c.animate.lockPub();b.ajax({type:"POST",url:"/logged/ajax/createreply",data:"reply="+encodeURIComponent(e)+"&scapeid="+d,error:function(){c.animate.displayReplyError();c.animate.unlockPub(true,"reply")},success:function(g){var f=b.parseJSON(g);var h=f.replyid;window.notifUrl=f.notifUrl;if(c.isNumeric(h)&&h!=""){c.reply.get(h);c.animate.displayReplyConfirmation();c.animate.unlockPub(false,"reply")}else{c.animate.displayReplyError();c.animate.unlockPub(true,"reply")}}})}},get:function(d){b.ajax({type:"POST",url:"/logged/ajax/postedreply",data:"replyid="+d,success:function(e){c.animate.displayPostedReply(e)}})},edit:function(f){var d;c.emoToText(f,"reply");if(b("#R"+f+" .fullContent").length!=0){d=c.processInput(b("#R"+f+" .fullContent").html(),"reply");b("#R"+f+" .replyBodyTxt").html(d)}else{d=c.processInput(b("#R"+f+" .replyBodyTxt").html(),"reply")}if(b("#R"+f+" .editBtnLink").html()=="Edit"){c.publisher.create("RB"+f,"replyEditor");c.animate.lockUI();c.animate.unlockElm("#R"+f);b("#R"+f+" .likesAndDislikes").hide();b("#R"+f+" .showAllComments").hide();b("#R"+f+" .editBtnLink").html("Done editing")}else{b("#R"+f+" .editBtnLink").html("Edit");var e=c.processInput(replyEditor.getEditorHTML(),"reply");replyEditor.destroy();if(c.hasText(e,false)){b("#R"+f+" .replyBodyTxt").html(c.textToEmo(e))}else{b("#R"+f+" .replyBodyTxt").html(c.textToEmo(d))}if(d!=e&&c.hasText(e,false)){b.ajax({type:"POST",url:"/logged/ajax/editreply",data:"replyid="+f+"&reply="+encodeURIComponent(e),success:function(){b("#R"+f).removeAttr("style");b("#R"+f+" .likesAndDislikes").show();b("#R"+f+" .showAllComments").show();c.animate.unlockUI()}})}else{b("#R"+f).removeAttr("style");b("#R"+f+" .likesAndDislikes").show();b("#R"+f+" .showAllComments").show();c.animate.unlockUI()}}},displayReplies:function(e,d,g,f){if(b("#batch"+f).html()==""||b("#batch"+f).html()==null){b(".replyBatch").hide();b("#batch"+f).html(c.progressBar).show();b("#batch"+f+" .progressBar").attr("style","margin-top: 15px");b.ajax({type:"POST",url:"/logged/ajax/displayreplies",data:"scapeid="+e+"&offset="+g+"&limit="+d,success:function(h){b("#batch"+f).html(h);b("#replies div.CGReply").css({display:"block"})}})}else{b(".replyBatch").hide();b("#batch"+f).show()}},deleteReply:function(d){b.ajax({type:"POST",url:"/logged/ajax/delete",data:"elmid="+d+"&idType=reply",success:function(){b("#R"+d).slideUp("slow",function(){b("#R"+d).remove()})}})}},photo:{makeCurrent:function(d){b.ajax({type:"POST",url:"/logged/ajax/makecurrent",data:"photoid="+d,success:function(){c.animate.jelloon("This photo is now your profile picture.",true)}})},edit:function(f){if(f!=null){b("#editCaption").attr("disabled","true");b("#editCaption").css("background-color","#DDD");b("#editLocation").attr("disabled","true");b("#editLocation").css("background-color","#DDD");var e=b("#editCaption").val();var d=b("#editLocation").val();b.ajax({type:"POST",url:"/logged/ajax/editphotodetails",data:"photoid="+f+"&caption="+encodeURIComponent(e)+"&location="+encodeURIComponent(d),success:function(){b("#editCaption").removeAttr("disabled");b("#editCaption").css("background-color","white");b("#caption").html(b("#editCaption").val());b("#editLocation").removeAttr("disabled");b("#editLocation").css("background-color","white");b("#location").html(b("#editLocation").val());if(d!=""){b(".location").show()}else{b(".location").hide()}if(e!=""){b(".addCaption").hide()}else{b(".addCaption").show()}c.animate.photo.toggleEditor("hide")}})}},deletePhoto:function(d){b.ajax({type:"POST",url:"/logged/ajax/delete",data:"elmid="+d+"&idType=photo",success:function(){c.animate.jelloon("This photo has been deleted.",true);setTimeout(function(){var e="/"+b("#session").attr("username")+"/gallery";b(location).attr("href",e)},3000)}})}},comment:{create:function(i,d){var e,h,f;f=c.getIdAndType(i);h=f.id;e=f.idType;var g=c.processInput(commentPublisher.getEditorHTML(),"comment");if(c.hasText(g)&&i!=null&&e!=null){c.animate.lockMiniPub(i);b.ajax({type:"POST",url:"/logged/ajax/createcomment",data:"comment="+encodeURIComponent(g)+"&elmid="+h+"&idType="+e,error:function(){c.animate.unlockMiniPub(true,i)},success:function(l){var k=b.parseJSON(l);var j=k.commentid;if(d=="commentWindow"){c.animate.unlockMiniPub(false,i);c.comment.get(j)}else{c.animate.commentCount(i)}}})}},get:function(d){b.ajax({type:"POST",url:"/logged/ajax/postedcomment",data:"commentid="+d,success:function(e){b("#comments").append(e)}})},edit:function(i){var e,h,g,f,d;g=c.getIdAndType(i);h=g.id;e=g.idType;c.emoToText(h,"comment");f=c.processInput(b("#CB"+h).html(),"comment");b("#CB"+h).html(f);if(b("#C"+h+" .editBtn").html().match(/<a>Edit<\/a>/i)){c.publisher.create("CB"+h,"commentEditor");b("#C"+h+" .editBtn").html("<a>Done editing</a>");b(".sectionOverlay").show();c.animate.unlockElm("#C"+h)}else{b("#C"+h+" .editBtn").html("<a>Edit</a>");d=c.processInput(commentEditor.getEditorHTML(),"comment");commentEditor.destroy();b("#CB"+h).html(c.textToEmo(d));if(d!=f&&c.hasText(d,false)){b.ajax({type:"POST",url:"/logged/ajax/editcomment",data:"comment="+encodeURIComponent(d)+"&commentid="+h,success:function(j){b(".sectionOverlay").hide();b("#C"+h).removeAttr("style")}})}else{b(".sectionOverlay").hide();b("#C"+h).removeAttr("style")}}},deleteComment:function(d){b.ajax({type:"POST",url:"/logged/ajax/delete",data:"elmid="+d+"&idType=comment",success:function(){b("#C"+d).slideUp("slow",function(){b("#C"+d).remove();b(".sectionOverlay").hide()})}})},getAllOnElm:function(g){var d,f,e;e=c.getIdAndType(g);f=e.id;d=e.idType;if(g!=null&&d!=null){c.animate.displayReplyWindow("scape");c.UIWindow.reply(f)}}},like:{create:function(g){var d,f,e;e=c.getIdAndType(g);f=e.id;d=e.idType;b("#"+g+" .spinner").show();b.ajax({type:"POST",url:"/logged/ajax/likesdislikes",data:"elmid="+f+"&idType="+d+"&l=1",success:function(h){c.animate.like(g,h);b("#"+g+" .spinner").hide()}})}},dislike:{create:function(g){var d,f,e;e=c.getIdAndType(g);f=e.id;d=e.idType;b("#"+g+" .spinner").show();b.ajax({type:"POST",url:"/logged/ajax/likesdislikes",data:"elmid="+f+"&idType="+d+"&d=1",success:function(h){c.animate.dislike(g,h);b("#"+g+" .spinner").hide()}})}},watch:{create:function(e,d){b.ajax({type:"POST",url:"/logged/ajax/watch",data:"targetid="+d,success:function(){b(e).replaceWith(c.watchStatusWatching)}})},unwatch:function(e,d){b.ajax({type:"POST",url:"/logged/ajax/ignore",data:"watchid="+d,success:function(){b(e).parents(".watchlistEntry").slideUp()}})}},notifMailer:{send:function(d){b.ajax({type:"GET",url:d})}},notif:{deleteNotif:function(e,d){b.ajax({type:"POST",url:"/logged/ajax/deletenotif",data:"jsonids="+d,error:function(){},success:function(){b("#N"+e).slideUp(function(){b("#N"+e).remove()})}})}},searchSuggestions:{create:function(){b(document).ready(function(){var d=500;var g="";b("#privacySearchInput").bind("keyup",f);function f(){var i=new Date().getTime();var j=this._keyPressedAt||i;this._keyPressedAt=i;if(!this._monitoringSearch){this._monitoringSearch=true;var h=this;window.setTimeout(function(){e(h)},0)}}function e(h){var i=new Date().getTime();var k=h._keyPressedAt;if((i-k)>d){if(h.value!=g){g=h.value;var j=b.trim(b("#privacySearchInput").val());if(j.match(/^([a-zA-Z0-9@ _-]+)$/)&&j!=""||j.match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i)){b.ajax({type:"POST",url:"/logged/ajax/search",data:"query="+j,success:function(l){if(l!=""){b("#privacySearchSuggestions").html(l).show();b("#privacySearchSuggestions li:first").addClass("selected")}else{b("#privacySearchSuggestions").html("").hide()}}})}else{b("#privacySearchSuggestions").html("").hide()}}h._monitoringSearch=false}else{window.setTimeout(function(){e(h)},0)}}});b(document).keydown(function(f){var d=0;if(f===null){d=event.keyCode}else{d=f.which}switch(d){case 38:b("#privacySearchSuggestions li").each(function(){if(b(this).hasClass("selected")){curIndex=b(this).index();if(curIndex!==0){b(this).removeClass("selected")}}});newIndex=curIndex-1;b("#privacySearchSuggestions li:eq("+newIndex+")").addClass("selected");break;case 40:b("#privacySearchSuggestions li").each(function(){if(b(this).hasClass("selected")){curIndex=b(this).index();if(b("#privacySearchSuggestions li:last").index()!=curIndex){b(this).removeClass("selected")}}});newIndex=curIndex+1;b("#privacySearchSuggestions li:eq("+newIndex+")").addClass("selected");break;case 13:b("#privacySearchSuggestions li").each(function(){if(b(this).hasClass("selected")){curIndex=b(this).index();b(this).trigger("click")}});break}});b(document).click(function(){b("#privacySearchSuggestions").hide()});b("#privacySearchSuggestions li").live("click",function(){b("#privacySearchInput").val("");newElmid=b(this).attr("id");unique=1;b("#privacyList div").each(function(){if(b(this).attr("id")==newElmid){unique=false}});if(unique){b("#privacyList").append('<div id="'+newElmid+"\" class='item'><span class='userName'>"+b("span",this).html()+"</span><span onclick=\"$('#"+newElmid+"').remove();\" class='removeBtn' title='Remove'>X</span></div>")}})}},UIWindow:{reply:function(d){b.ajax({type:"POST",url:"/logged/ajax/uiwreply",data:"replyid="+d,error:function(){},success:function(e){c.windowManager.setWindowContents("replyWindow",e)}})},comments:function(g){c.windowManager.setWindowContents("commentWindow",c.progressBar);b("#commentWindow .progressBar").attr("style","margin-top: 180px;");var d,f,e;e=c.getIdAndType(g);f=e.id;d=e.idType;b.ajax({type:"POST",url:"/logged/ajax/uiwcomments",data:"id="+f+"&idType="+d,success:function(h){c.windowManager.setWindowContents("commentWindow",h)}})},listUsers:function(d,e){c.animate.displayListUsersWindow(e);b.ajax({type:"POST",url:"/logged/ajax/uiwlistusers",data:"jsonids="+d+"&type="+e,error:function(){},success:function(f){c.windowManager.setWindowContents("listUsersWindow",f)}})},feedback:function(){b.ajax({url:"/logged/ajax/uiwfeedback",error:function(){},success:function(d){b(".UIWindow").hide();b("#feedbackWindowContainer").html(d).show();c.animate.lockUI()}})},feedbackSubmit:function(f,g,e,d){b.ajax({type:"POST",url:"/logged/ajax/submitfeedback",data:"type="+f+"&content="+g+"&thumbsup="+e+"&thumbsdown="+d,error:function(){},success:function(){}});c.animate.jelloon("Thanks again! ...Your feedback has been submitted.",true)}},headingCounter:{create:function(g){b("div.heading").hide();b("#insertTitleBtnContainer").click(function(){b("div.heading").slideDown("fast");b("div.heading textarea").focus()});b("div.heading span.cancelBtn").click(function(){b("div.heading").slideUp("fast");b("#headingBox").val("");b("span.charCounter").html("100").css("color","#00ad00")});var d=function(j){b("#headingBox").unbind().keyup(function(){if(document.activeElement.id==="headingBox"){var m=b(this).val();var l=m.length;var k=j-l;if(l<=j){b("span.charCounter").html("").html(k).css("color","#000")}else{b("span.charCounter").html("").html(k).css("color","#f00")}}})};var i=100;var h=b("#headingBox").val();var f=h.length;var e=100-f;b("span.charCounter").html(e);d(i);if(g==="scape"){b(".postTitleEditor").focus(function(){b("span.deleteBtn.heading").fadeIn("fast");b("span.charCounter").fadeIn("fast");if(b(".postTitleEditor").val()==""||b(".postTitleEditor").val()=="Add a title..."){b(".postTitleEditor").html("").css("color","#333")}});b(".postTitleEditor").blur(function(){b("span.deleteBtn.heading").fadeOut("fast");b("span.charCounter").fadeOut("fast");if(b(this).val()==""){b(".postTitleEditor").html("Add a title...").css("color","#999")}});b("span.deleteBtn.heading").bind("click",function(){b(".postTitleEditor").html("");b("span.charCounter").html("100")});if(b("#headingBox").val()==""){b(".postTitleEditor").html("Add a title...").css("color","#999")}else{b(".postTitleEditor").html("").css("color","#333")}}}},signup:{bootloader:function(){b("#firstname").bind("blur",function(){c.signup.validateFirstname()});b("#lastname").bind("blur",function(){c.signup.validateLastname()});b("#email").bind("blur",function(){c.signup.validateEmail()});b("#username").bind("blur",function(){c.signup.validateUsername()});b("#password").bind("blur",function(){c.signup.validatePassword()})},validateFirstname:function(){var d=b.trim(b("#firstname").val());if(d.match(/^[a-zA-Z\s]{2,20}$/)){b("#firstnameField .field").removeClass("negative").addClass("affirmative");b("#firstnameField .actionFeedback").html("OK").removeClass("negative").addClass("positive").show().attr("style","display: inline block;");b("#firstnameError").slideUp("fast");c.validFirstname=true;return true}else{if(d==""){b("#firstnameField .field").removeClass("negative").removeClass("affirmative");b("#firstnameField .actionFeedback").html("").hide();b("#firstnameError").slideUp("fast");c.validFirstname=false;return false}else{b("#firstnameField .field").removeClass("affirmative").addClass("negative");b("#firstnameField .actionFeedback").html("Invalid!").removeClass("positive").addClass("negative").attr("style","display: inline block;");b("#firstnameError").slideDown("fast");c.validFirstname=false;return false}}},validateLastname:function(){var d=b.trim(b("#lastname").val());if(d.match(/^[a-zA-Z\s]{2,20}$/)){b("#lastnameField .field").removeClass("negative").addClass("affirmative");b("#lastnameField .actionFeedback").html("OK").removeClass("negative").addClass("positive").show();b("#lastnameError").slideUp("fast");c.validLastname=true;return true}else{if(d==""){b("#lastnameField .field").removeClass("negative").removeClass("affirmative");b("#lastnameField .actionFeedback").html("").hide();b("#lastnameError").slideUp("fast");c.validLastname=false;return false}else{b("#lastnameField .field").removeClass("affirmative").addClass("negative");b("#lastnameField .actionFeedback").html("Invalid!").removeClass("positive").addClass("negative").show();b("#lastnameError").slideDown("fast");c.validLastname=false;return false}}},validateEmail:function(){var d=b.trim(b("#email").val());if(d.match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i)){b.ajax({type:"POST",url:"/logged/ajax/checkemail",data:"email="+d,async:false,success:function(e){if(e=="true"){b("#emailField .field").removeClass("affirmative").addClass("negative");b("#emailField .actionFeedback").html("Exists!").removeClass("positive").addClass("negative").show();b("#emailError").slideUp("fast");c.validEmail=false;return false}else{b("#emailField .field").removeClass("negative").addClass("affirmative");b("#emailField .actionFeedback").html("OK").removeClass("negative").addClass("positive").show();b("#emailError").slideUp("fast");c.validEmail=true;return true}}})}else{if(d==""){b("#emailField .field").removeClass("negative").removeClass("affirmative");b("#emailField .actionFeedback").html("").hide();b("#emailError").slideUp("fast");c.validEmail=false;return false}else{b("#emailField .field").removeClass("affirmative").addClass("negative");b("#emailField .actionFeedback").html("Invalid!").removeClass("positive").addClass("negative").show();b("#emailError").slideDown("fast")}c.validEmail=false;return false}},validateUsername:function(){var d=b.trim(b("#username").val());if(d.match(/^[a-zA-Z0-9._-]{2,20}$/)){b.ajax({type:"POST",url:"/logged/ajax/checkusername",data:"username="+d,async:false,success:function(e){if(e=="true"){b("#usernameField .field").removeClass("affirmative").addClass("negative");b("#usernameField .actionFeedback").html("Taken!").removeClass("positive").addClass("negative").show();b("#usernameError").slideUp("fast");c.validUsername=false;return false}else{b("#usernameField .field").removeClass("negative").addClass("affirmative");b("#usernameField .actionFeedback").html("OK").removeClass("negative").addClass("positive").show();b("#usernameError").slideUp("fast");c.validUsername=true;return true}}})}else{if(d==""){b("#usernameField .field").removeClass("negative").removeClass("affirmative");b("#usernameField .actionFeedback").html("").hide();b("#usernameError").slideUp("fast");c.validUsername=false;return false}else{b("#usernameField .field").removeClass("affirmative").addClass("negative");b("#usernameField .actionFeedback").html("Invalid!").removeClass("positive").addClass("negative").show();b("#usernameError").slideDown("fast");c.validUsername=false;return false}}},validatePassword:function(){var d=b.trim(b("#password").val());if(d.match(/^.{6,}$/)){b("#passwordField .field").removeClass("negative").addClass("affirmative");b("#passwordField .actionFeedback").html("OK").removeClass("negative").addClass("positive").show();b("#passwordError").slideUp("fast");c.validPassword=true;return true}else{if(d==""){b("#passwordField .field").removeClass("negative").removeClass("affirmative");b("#passwordField .actionFeedback").html("").hide();b("#passwordError").slideUp("fast");c.validPassword=false;return false}else{b("#passwordField .field").removeClass("affirmative").addClass("negative");b("#passwordField .actionFeedback").html("Invalid!").removeClass("positive").addClass("negative").show();b("#passwordError").slideDown("fast");c.validPassword=false;return false}}},submit:function(){var d=b("#recaptcha_response_field").val();if(d==""){c.validCaptcha=false}else{c.validCaptcha=true}c.signup.validateFirstname();c.signup.validateLastname();c.signup.validateEmail();c.signup.validateUsername();c.signup.validatePassword();if(c.validFirstname&&c.validLastname&&c.validEmail&&c.validUsername&&c.validPassword&&c.validCaptcha){b("#signupForm").submit()}else{b("#errorSpace").slideDown("fast")}}},homePage:{bootloader:function(){c.publisher.create("pubTarget","scapePublisher");b("#pubPlaceholder").click(function(){b("div.heading").slideUp("fast");b("#lowerPanel").show()});b("body").click(function(){var d=c.processInput(scapePublisher.getEditorHTML(),"scape");if(b.trim(d)!=""){b("#pubPlaceholder").html(d)}else{b("#pubPlaceholder").html('<span style="color: #777">Express yourself...</span>')}b(".yui-editor-editable-container").attr("style","height:70px")});b("#publisher").click(function(d){d.stopPropagation()});c.headingCounter.create("home");b("#loadMoreBtn").click(function(){if(!c.mult){c.mult=0}c.mult++;offset=10*c.mult+10;c.scape.load("home",null,offset)});b(window).scroll(function(){if(b(window).scrollTop()+40>b(document).height()-b(window).height()){if(!c.loadMore){c.scape.load("home",null,"10");c.loadMore=true}}});c.emoticonTable();b(".scape").live("mouseenter",function(){b(".readMore",this).stop(true,true).fadeIn("fast")});b(".scape").live("mouseleave",function(){b(".readMore",this).stop(true,true).fadeOut("fast")})}},scapePage:{bootloader:function(j,g){var d,l,f,e,k,i,h;c.publisher.create("replyPubTarget","replyPublisher");c.publisher.create("scapeEditor","scapeEditor");b("#pubPlaceholder").click(function(){b("div.bubbleArrow").css("background","transparent url('/graphics/en/sprites/publisher_arrows.png') no-repeat 0 -46px")});b("body").click(function(){var m=c.processInput(replyPublisher.getEditorHTML(),"reply");if(b.trim(m)!=""){b("#pubPlaceholder").html(m)}else{b("#pubPlaceholder").html("")}b("#publisher .yui-editor-editable-container").attr("style","height:70px")});b("#publisher").click(function(m){m.stopPropagation()});d=b(".CGPost").attr("id").replace(/S/,"");c.headingCounter.create("scape");c.emoticonTable();b("#slider").slider({max:j,value:j,stop:function(){l=b("#slider").slider("option","value");l=j-l;l++;f=10*(l-1);e=10;l--;k=g-10-f+1;i=g-f;if(l==j){e=g-f;f=g-10;k=1;i=e}l++;c.reply.displayReplies(d,e,g-10-f,l);b("#replyCounter").html('Showing replies <span class="lowerLimit">'+k+'</span> to <span class="upperLimit">'+i+'</span><span class="totalReplies"> of '+g+"</span>");b("#currentlyShowing").html(k+" to "+i)}})}},profilePage:{bootloader:function(){b("#pmEdit").click(function(){var d;c.orignalPm=b.trim(b("#pmSpan").html());if(c.orignalPm=="A little personal message..."){d=""}else{d=c.orignalPm}b("#pmSpan").html("<textarea id='pmEditor' maxlength='400'>"+d+"</textarea>");b("#pmEditor").focus();b(this).hide()});b("#pmEditor").live("blur",function(){if(b.trim(b(this).val())==""){b("#pmSpan").html("A little personal message...")}else{b("#pmSpan").html(b(this).val())}b.ajax({type:"POST",url:"/logged/ajax/savepm",data:"pm="+encodeURIComponent(b.trim(b("#pmSpan").html()))});b("#pmEdit").show();b(this).remove()});b("#loadMoreBtn").click(function(){if(!window.mult){window.mult=0}window.mult++;offset=10*window.mult+10;ajaxDisplayTimeline("profile",b("#owner").attr("userid"),offset)});b("#timelineTab").click(function(){b("#timelineTab").addClass("activeTab");b("#infoTab").removeClass("activeTab");b("#infoDisplay").hide();b("#scapes").show()});b("#infoTab").click(function(){b("#infoTab").addClass("activeTab");b("#timelineTab").removeClass("activeTab");b("#scapes").hide();b("#infoDisplay").show();if(!c.profileInfoLoaded){b("#infoDisplay").html(c.progressBar);b("#infoDisplay .progressBar").attr("style","margin-top: 50px");b.ajax({type:"POST",url:"/logged/ajax/infodisplay",data:"ownerid="+b("#owner").attr("userid")+"&ownerUsername="+b("#owner").attr("username")+"&ownerFirstname="+b("#owner").attr("firstname"),success:function(d){b("#infoDisplay").html(d);c.profileInfoLoaded=true}})}});b(".scape").live("mouseenter",function(){b(".readMore",this).stop(true,true).fadeIn("fast")});b(".scape").live("mouseleave",function(){b(".readMore",this).stop(true,true).fadeOut("fast")})}},photoPage:{bootloader:function(){function d(e){if(e=="hide"){b("#detailEditor").hide();b(".photoActions").show();b("#lowerControls").show();b(".photoNaviControls").show();b("#caption").show();if(b("#caption").html()==""){b("#addCaption").show()}b(".metadata").show();toggleShortcuts("add")}else{b("#detailEditor").show();b("#addCaption").hide();b("#caption").hide();b(".metadata").hide();b(".photoActions").hide();b("#lowerControls").hide();b(".photoNaviControls").hide();toggleShortcuts("remove");b("#editLocation").val(b("#location").html());b("#editCaption").val(b("#caption").html())}}}},publisher:{create:function a(e,g){function j(){b("#"+e+"_editor").contents().find("img").each(function(){var p=b(this).attr("align");switch(p){case"center":b(this).attr("class","CGImage center");break;case"left":b(this).attr("class","CGImage left");break;case"right":b(this).attr("class","CGImage right");break}var o=400;var n=300;var m=0;var l=b(this).width();var k=b(this).height();if(l>o){m=o/l;b(this).css("width",o);b(this).css("height",k*m);k=k*m;l=l*m;b(this).attr("width",l).attr("height",k)}if(k>n){m=n/k;b(this).css("height",n);b(this).css("width",l*m);l=l*m;b(this).attr("width",l).attr("height",n)}})}function f(){b("#"+e+"_editor").contents().find("head").append("<style>\n    a {color:#6666d5 !important;text-decoration:none !important;}\n    a:hover, a:focus {color:#3399ff !important;text-decoration:underline !important;cursor:pointer !important;outline: none !important;}\n    a:active {color: #000099 !important;text-decoration: underline !important;outline: none !important;}\n    .center {display:block; margin-left:auto; margin-right:auto;}\n    img{padding: 13px;}\n    </style>")}function h(k){var l=b.trim(k.getEditorHTML());if(l=="<BR>"||l=="<P>&nbsp;</P>"){k.setEditorHTML("")}}function i(){b("#"+e+"_editor").contents().find("img").each(function(){var k=b(this);if(k.hasClass("yui-img")&&k.attr("src")=="http://yui.yahooapis.com/2.8.1/build/editor/assets/skins/sam/blankimage.png"){var l=top.location.host;k.attr("src","http://"+l+"/graphics/en/logos/the_big_o_placeholder_103px.png")}})}function d(){b(".yui-toolbar-block").attr("title","Center");b(".createlink_target").attr("checked",true)}switch(g){case"cleaner":window.cleaner=new YAHOO.widget.Editor(e,{});break;case"scapePublisher":window.scapePublisher=new YAHOO.widget.Editor(e,{animate:true,toolbar:{titlebar:" ",buttons:[{type:"separator"},{group:"textstyle",label:"",buttons:[{type:"push",label:"Bold",value:"bold"},{type:"push",label:"Italic",value:"italic"},{type:"push",label:"Underline",value:"underline"},{type:"push",label:"Strike through",value:"strikethrough"},{type:"separator"},{type:"push",label:"Super script",value:"superscript",disabled:true},{type:"push",label:"Sub script",value:"subscript",disabled:true}]},{type:"separator"},{group:"indentlist",label:"",buttons:[{type:"push",label:"Create an unordered list",value:"insertunorderedlist"},{type:"push",label:"Create an ordered list",value:"insertorderedlist"},{type:"push",label:"Remove Formatting",value:"removeformat",disabled:true}]},{type:"separator"},{group:"insertitem",label:"",buttons:[{type:"push",label:"Create HTML link",value:"createlink",disabled:true},{type:"push",label:"Insert Image",value:"insertimage"}]}]}});scapePublisher.on("editorContentLoaded",function(){f()},scapePublisher,true);scapePublisher.on("editorKeyDown",function(){h(this)},scapePublisher,true);scapePublisher.on("windowinsertimageClose",function(){j()},scapePublisher,true);scapePublisher.on("beforeOpenWindow",function(){i();d()},scapePublisher,true);scapePublisher.on("editorMouseDown",function(){b("div.heading").slideUp("fast");b(".yui-editor-editable-container").attr("style","height:200px")},scapePublisher,true);scapePublisher.render();break;case"replyPublisher":window.replyPublisher=new YAHOO.widget.Editor(e,{animate:true,focusAtStart:true,toolbar:{titlebar:" ",buttons:[{type:"separator"},{group:"textstyle",label:"",buttons:[{type:"push",label:"Bold",value:"bold"},{type:"push",label:"Italic",value:"italic"},{type:"push",label:"Underline",value:"underline"},{type:"push",label:"Strike through",value:"strikethrough"},{type:"separator"},{type:"push",label:"Super script",value:"superscript",disabled:true},{type:"push",label:"Sub script",value:"subscript",disabled:true}]},{type:"separator"},{group:"indentlist",label:"",buttons:[{type:"push",label:"Create an unordered list",value:"insertunorderedlist"},{type:"push",label:"Create an ordered list",value:"insertorderedlist"},{type:"push",label:"Remove Formatting",value:"removeformat",disabled:true}]},{type:"separator"},{group:"insertitem",label:"",buttons:[{type:"push",label:"Create HTML link",value:"createlink",disabled:true}]}]}});replyPublisher.on("editorContentLoaded",function(){f()},replyPublisher,true);replyPublisher.on("editorKeyDown",function(){h(this)},replyPublisher,true);replyPublisher.on("beforeOpenWindow",function(){d()},replyPublisher,true);replyPublisher.on("editorMouseDown",function(){b("div.heading").slideUp("fast");b("#publisher .yui-editor-editable-container").attr("style","height:200px")},replyPublisher,true);replyPublisher.render();break;case"commentPublisher":window.commentPublisher=new YAHOO.widget.Editor(e,{height:"100px",animate:true,focusAtStart:true,toolbar:{titlebar:" ",buttons:[{type:"separator"},{group:"textstyle",label:"",buttons:[{type:"push",label:"Bold",value:"bold"},{type:"push",label:"Italic",value:"italic"},{type:"push",label:"Underline",value:"underline"},{type:"push",label:"Strike through",value:"strikethrough"}]},{type:"separator"},{group:"indentlist",label:"",buttons:[{type:"push",label:"Remove Formatting",value:"removeformat",disabled:true}]},{type:"separator"},{group:"insertitem",label:"",buttons:[{type:"push",label:"Create HTML link",value:"createlink",disabled:true}]}]}});commentPublisher.on("editorContentLoaded",function(){f()},commentPublisher,true);commentPublisher.on("editorKeyDown",function(){h(this)},commentPublisher,true);commentPublisher.on("beforeOpenWindow",function(){d()},commentPublisher,true);commentPublisher.render();break;case"scapeEditor":window.scapeEditor=new YAHOO.widget.Editor(e,{height:"300px",animate:true,focusAtStart:true,toolbar:{titlebar:" ",buttons:[{type:"separator"},{group:"textstyle",label:"",buttons:[{type:"push",label:"Bold",value:"bold"},{type:"push",label:"Italic",value:"italic"},{type:"push",label:"Underline",value:"underline"},{type:"push",label:"Strike through",value:"strikethrough"},{type:"separator"},{type:"push",label:"Super script",value:"superscript",disabled:true},{type:"push",label:"Sub script",value:"subscript",disabled:true}]},{type:"separator"},{group:"indentlist",label:"",buttons:[{type:"push",label:"Create an unordered list",value:"insertunorderedlist"},{type:"push",label:"Create an ordered list",value:"insertorderedlist"},{type:"push",label:"Remove Formatting",value:"removeformat",disabled:true}]},{type:"separator"},{group:"insertitem",label:"",buttons:[{type:"push",label:"Create HTML link",value:"createlink",disabled:true},{type:"push",label:"Insert Image",value:"insertimage"}]}]}});scapeEditor.on("editorContentLoaded",function(){f()},scapeEditor,true);scapeEditor.on("editorKeyDown",function(){h(this)},scapeEditor,true);scapeEditor.on("windowinsertimageClose",function(){j()},scapeEditor,true);scapeEditor.on("beforeOpenWindow",function(){i();d()},scapeEditor,true);scapeEditor.render();break;case"replyEditor":window.replyEditor=new YAHOO.widget.Editor(e,{height:"150px",animate:true,focusAtStart:true,toolbar:{titlebar:" ",buttons:[{type:"separator"},{group:"textstyle",label:"",buttons:[{type:"push",label:"Bold",value:"bold"},{type:"push",label:"Italic",value:"italic"},{type:"push",label:"Underline",value:"underline"},{type:"push",label:"Strike through",value:"strikethrough"},{type:"separator"},{type:"push",label:"Super script",value:"superscript",disabled:true},{type:"push",label:"Sub script",value:"subscript",disabled:true}]},{type:"separator"},{group:"indentlist",label:"",buttons:[{type:"push",label:"Create an unordered list",value:"insertunorderedlist"},{type:"push",label:"Create an ordered list",value:"insertorderedlist"},{type:"push",label:"Remove Formatting",value:"removeformat",disabled:true}]},{type:"separator"},{group:"insertitem",label:"",buttons:[{type:"push",label:"Create HTML link",value:"createlink",disabled:true}]}]}});replyEditor.on("editorContentLoaded",function(){f()},replyEditor,true);replyEditor.on("editorKeyDown",function(){h(this)},replyEditor,true);replyEditor.on("beforeOpenWindow",function(){d()},replyEditor,true);replyEditor.render();break;case"commentEditor":window.commentEditor=new YAHOO.widget.Editor(e,{height:"100px",width:"338px",animate:true,focusAtStart:true,toolbar:{titlebar:" ",buttons:[{type:"separator"},{group:"textstyle",label:"",buttons:[{type:"push",label:"Bold",value:"bold"},{type:"push",label:"Italic",value:"italic"},{type:"push",label:"Underline",value:"underline"},{type:"push",label:"Strike through",value:"strikethrough"}]},{type:"separator"},{group:"indentlist",label:"",buttons:[{type:"push",label:"Remove Formatting",value:"removeformat",disabled:true}]},{type:"separator"},{group:"insertitem",label:"",buttons:[{type:"push",label:"Create HTML link",value:"createlink",disabled:true}]}]}});commentEditor.on("editorContentLoaded",function(){f()},commentEditor,true);commentEditor.on("editorKeyDown",function(){h(this)},commentEditor,true);commentEditor.on("beforeOpenWindow",function(){d()},commentEditor,true);commentEditor.render();break}},remove:function(d,e){if(c.pubfull){c.pubfull.removeInstance(e)}b("#"+d).html("")}},animate:{photo:{toggleEditor:function(d){if(d=="hide"){b("#detailEditor").hide();b(".photoActions").show();b("#lowerControls").show();b(".photoNaviControls").show();b("#caption").show();if(b("#caption").html()==""){b("#addCaption").show()}b(".metadata").show()}else{if(d=="show"){b("#detailEditor").show();b("#addCaption").hide();b("#caption").hide();b(".metadata").hide();b(".photoActions").hide();b("#lowerControls").hide();b(".photoNaviControls").hide();b("#editLocation").val(b("#location").html());b("#editCaption").val(b("#caption").html())}}}},jelloon:function(e,d){if(!d){b("#jelloonNeg").remove();b("#mainWrapper").prepend(c.jellooNeg);b("#jelloonNeg").html(e)}else{b("#jelloonAffirm").remove();b("#mainWrapper").prepend(c.jelloonAffirm);b("#jelloonAffirm").html(e)}},displayNewLoadedScapes:function(d){b(".progressBar").remove();b("#timelineFeed").append(d);b("#loadMoreBtn").show()},displayPostedScape:function(d){b("#timelineFeed").prepend(d);b("#timelineFeed div.scape").slideDown("slow");b("#noPosts").remove()},displayPostedReply:function(d){b("#batch1").append(d);b("#replies div.CGReply").slideDown("slow")},displayScapeError:function(){b("#scapeError").fadeIn(2000,function(){b("#scapeError").fadeOut(2000)});c.animate.unlockPub(true)},displayReplyError:function(){b("#replyError").fadeIn(2000,function(){b("#replyError").fadeOut(2000)});c.animate.unlockPub(true,"reply")},displayReplyConfirmation:function(){b("#replyConfirmation").fadeIn(2000,function(){b("#replyConfirmation").fadeOut(2000)})},displayReplyWindow:function(d){c.windowManager.drawWindow("replyWindow","Showing all comments on this reply","center","570","478");c.windowManager.setWindowContents("replyWindow",c.progressBar);b("#replyWindow .progressBar").attr("style","margin-top: 180px;");b("#replyWindow").addClass("allComments")},displayListUsersWindow:function(d){switch(d){case"like":c.windowManager.drawWindow("listUsersWindow","These people like this","center","490","478");break;case"dislike":c.windowManager.drawWindow("listUsersWindow","These people don't like this","center","490","478");break;case"watch":c.windowManager.drawWindow("listUsersWindow","These people are now watching you","center","490","478");break;case"reply":c.windowManager.drawWindow("listUsersWindow","These people replied to your scape","center","490","478");break;case"comment":c.windowManager.drawWindow("listUsersWindow","These people commented on this","center","490","478");break}c.windowManager.setWindowContents("listUsersWindow",c.progressBar);b("#listUsersWindow").addClass("UITableView").css("width","502px");b("#listUsersWindow .progressBar").attr("style","margin-top: 180px;")},displayCommentBox:function(g){var d,f,e;e=c.getIdAndType(g);f=e.id;d=e.idType;if(b("#"+g+" div.commentComponent").is(":visible")){window.commentPublisher.destroy();window.commentPublisherDestroyed=true;b("#"+g+" div.commentComponent").fadeOut()}else{b("div.commentComponent").hide();if(!window.commentPublisherDestroyed&&window.commentPublisherDestroyed!==undefined){window.commentPublisher.destroy();window.commentPublisherDestroyed=true}c.publisher.create("minieditor"+f,"commentPublisher");window.commentPublisherDestroyed=false;b("#"+g+" div.commentComponent").fadeIn(400,function(){})}},commentCount:function(i){var f,d,e,h,g;g=c.getIdAndType(i);h=g.id;e=g.idType;f=b("#"+i+" .commentCount").html();b("#"+i+" .showAllCommentsBtnLink").hide().fadeIn().css("display","block").html('<span class="UIIcon px16 comment"></span>Comment posted!');switch(true){case (f==null):f='<span class="UIIcon px16 comment"></span>Show <span class="commentCount">1</span> comment.';d=null;break;case (f.match(/\d/)>=1):d=f.match(/\d/);d++;f='<span class="UIIcon px16 comment"></span>Show all <span class="commentCount">'+d+"</span> comments.";d=null;break}setTimeout(function(){b("#"+i+" .showAllCommentsBtnLink").hide().fadeIn(400,function(){c.animate.unlockMiniPub(false,i)}).html(f).css("display","block")},3000)},lockPub:function(){b("#postBtnLink").addClass("unavailable");b("#postBtnLink")[0].onclick=null;b("#pubSpinner").show()},unlockPub:function(d,e){if(!d){if(e==="scape"){scapePublisher.setEditorHTML("")}else{if(e==="reply"){replyPublisher.setEditorHTML("")}}b("#headingBox").val("");b("span.charCounter").html("100").css("color","#00ad00");b("#privacyList").html("")}b("#postBtnLink").removeClass("unavailable");b("div.headingPanel").slideUp("fast");b("#postBtnLink")[0].onclick=function(){if(e==="scape"){c.scape.create()}else{if(e==="reply"){c.reply.create()}}};b("#pubSpinner").hide()},lockMiniPub:function(d){b("#"+d+" .UIButton.post").addClass("unavailable");b("#"+d+" .UIButton.post")[0].onclick=null},unlockMiniPub:function(d,e){if(!d){commentPublisher.setEditorHTML("")}b("#"+e+" .UIButton.post").removeClass("unavailable");b("#"+e+" .UIButton.post")[0].onclick=function(){c.comment.create(e)}},lockUI:function(){b("#pageOverlay").show()},unlockUI:function(){b("#pageOverlay").hide()},unlockElm:function(d){b(d).css({position:"relative",zIndex:"3"})},like:function(j,f){var e,i,h;h=c.getIdAndType(j);i=h.id;e=h.idType;b("#"+j+" .likesAndDislikes").html(f);b("#"+j+" .userOpinions").hide();b("#"+j+" .userOpinions").fadeIn("fast");var g=b("#"+j+" .likeBtn").html();if(g=="<a>Like</a>"||g=="<A>Like</A>"){b("#"+j+" .likeBtn").html("<a>Remove like</a>")}if(g=="<a>Remove like</a>"||g=="<A>Remove like</A>"){b("#"+j+" .likeBtn").html("<a>Like</a>")}var d=b("#"+j+" .dislikeBtn").html();if(d=="<a>Remove dislike</a>"||d=="<A>Remove dislike</A>"){b("#"+j+" .dislikeBtn").html("<a>Dislike</a>")}},dislike:function(j,e){var d,i,h;h=c.getIdAndType(j);i=h.id;d=h.idType;b("#"+j+" .likesAndDislikes").html(e);b("#"+j+" .userOpinions").hide();b("#"+j+" .userOpinions").fadeIn("fast");var g=b("#"+j+" .dislikeBtn").html();if(g=="<a>Dislike</a>"||g=="<A>Dislike</A>"){b("#"+j+" .dislikeBtn").html("<a>Remove dislike</a>")}if(g=="<a>Remove dislike</a>"||g=="<A>Remove dislike</A>"){b("#"+j+" .dislikeBtn").html("<a>Dislike</a>")}var f=b("#"+j+" .likeBtn").html();if(f=="<a>Remove like</a>"||f=="<A>Remove like</A>"){b("#"+j+" .likeBtn").html("<a>Like</a>")}},editScape:function(e,f,d){if(d==="edit"){c.animate.lockUI();c.animate.unlockElm(".CGPost");b("#headingBox").html(b("#postTitle").html());scapeEditor.setEditorHTML(scapeEditor.cleanHTML(e));b("#scapeEditorHolder").show();b("#headingEditor").show();b("#scapeDoneEditingBtn").show();b("#scapeContent").hide();b("#postTitle").hide();b("#scapeOptions").hide();b("#editScapeToolTip").fadeIn(400,function(){setTimeout("$('.editInfo').fadeOut(400)",3000)})}else{if(d=="done_nochange"){if(f==""){b("#postTitle").hide()}else{b("#postTitle").show()}c.animate.unlockUI();b(".CGPost").removeAttr("style");b("#scapeContent").show();b("#scapeContent").html(e);scapeEditor.setEditorHTML("");b("#scapeEditorHolder").hide();b("#headingEditor").hide()}else{if(d==="done_change"){if(f==""){b("#postTitle").html("");b("#postTitle").hide()}else{b("#postTitle").html(f);b("#postTitle").show()}b("#scapeContent").show();b("#scapeOptions").show();b("#scapeDoneEditingBtn").hide();b(".CGPost").removeAttr("style");b("#scapeContent").html(e);scapeEditor.setEditorHTML("");b("#scapeEditorHolder").hide();b("#headingEditor").hide();b("#scapeOptionsMenu").hide();b("#doneEditingScapeToolTip").fadeIn(400,function(){setTimeout("$('.editInfo').fadeOut(400)",3000)});c.animate.unlockUI()}}}}},windowManager:{initPositioner:function(){(function(d){d.fn.positionCenter=function(e){var f={sTop:function(){return window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop},wHeight:function(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body.clientHeight}};return this.each(function(i){if(i==0){var j=d(this);var h=j.outerHeight();var g=f.sTop()+(f.wHeight()/2)-(h/2);j.css({top:g,left:((d(window).width()-j.outerWidth())/2)+"px"})}})}})(jQuery)},drawWindow:function(k,j,e,g,d){c.windowManager.initPositioner();var i='<div class="titleBar"><h2>'+j+'</h2><span class="closeBtn" title="Close" onclick="$(\'.UIWindow\').fadeOut(function(){$(\'#windowCompositionLayer\').remove();});O.animate.unlockUI();"><a><span class="UIIcon px16 cross"></span></a></span></div>';var h='<div class="UIWindowContents"></div>';var f='<div class="UIWindow" id='+k+">"+i+h+"</div>";b("#mainWrapper").prepend('<div id="windowCompositionLayer"></div>');b(f).appendTo("#windowCompositionLayer");b("#"+k+" .UIWindowContents").attr("style","width:"+g+"px;height:"+d+"px;");b("#"+k+" .UIWindow").show().positionCenter();if(e=="center"){b("#"+k+".UIWindow").positionCenter()}c.animate.lockUI()},setWindowContents:function(e,d){b("#"+e+" .UIWindowContents").html(d)}},isNumeric:function(d){return(typeof(d)==="number"||typeof(d)==="string")&&d!==""&&!isNaN(d)},hasText:function(e,d){if(d){if(e.replace(/(<[^img].*?>)|(&nbsp;)/ig,"").replace(/\s/g,"")!=""){return true}else{return false}}else{if(e.replace(/(<.*?>)|(&nbsp;)/ig,"").replace(/\s/g,"")!=""){return true}else{return false}}},processInput:function(f,e){switch(e){case"scape":f=d(f);f=c.stripTags(f,"<br><s><strong><em><u><sub><sup><ol><ul><li><a><img>");return f;break;case"reply":f=d(f);f=c.stripTags(f,"<br><s><strong><em><u><sub><sup><ol><ul><li><a>");return f;break;case"comment":f=d(f);f=c.stripTags(f,"<br><s><strong><em><u><a>");return f;break;case"text":f=c.stripTags(f);return f;break}function d(g){g=g.replace(/<\/div>/gi,"<br />");g=g.replace(/<\/p>/gi,"<br />");g=cleaner.cleanHTML(g);g=c.stripAttr(g);g=c.stripTags(g,"<br><s><span><strong><strike><em><u><sub><sup><ol><ul><li><a><img><h1><h2><h3><h4><h5><h6><h7>");b("#mainWrapper").prepend("<div id='temp' style='display:none;'>"+g+"</div>");b("#temp :header").each(function(){var h=b(this).html();b(this).replaceWith("<strong>"+h+"</strong><br /><br />")});b("#temp strike").each(function(){var h=b(this).html();b(this).replaceWith("<s>"+h+"</s>")});b("#temp span").each(function(){var h=b(this).html();var i=b(this).attr("style");if(i){if(i.match(/text-decoration: line-through;?/i)){b(this).replaceWith("<s>"+h+"</s>")}}});b("#temp span").each(function(){var h=b(this).html();var i=b(this).attr("style");if(i){if(i.match(/text-decoration: underline;?/i)){b(this).replaceWith("<u>"+h+"</u>")}}});b("#temp span").each(function(){var h=b(this).html();var i=b(this).attr("style");if(i){if(i.match(/text-decoration: underline line-through;?/i)||i.match(/text-decoration: line-through underline;?/i)){b(this).replaceWith("<s><u>"+h+"</u></s>")}}});b("#temp img").each(function(){var n=b(this).attr("align");var m=this.attributes;b(this).removeAttr("style");switch(n){case"center":b(this).attr("class","CGImage center");break;case"left":b(this).attr("class","CGImage left");break;case"right":b(this).attr("class","CGImage right");break;default:b(this).attr("class","CGImage center");break}var l=400;var k=300;var j=0;var i=b(this).width();var h=b(this).height();if(i>l){j=l/i;h=h*j;i=i*j;b(this).attr("width",i).attr("height",h)}if(h>k){j=k/h;i=i*j;b(this).attr("width",i).attr("height",k)}});b("#temp a").attr("target","_blank");b("#temp *").each(function(){var h=this.nodeName.toLowerCase();var i=b(this).html();if(!h.match(/br|img|hr|input|a/i)){b(this).replaceWith("<"+h+">"+i+"</"+h+">")}});g=b("#temp").html();b("#temp").remove();g=c.stripAttr(g);g=g.replace(/<(\/)*(\\?xml:|meta|link|span|font|del|ins|st1:|[ovwxp]:)((.|\s)*?)>/gi,"");g=g.replace(/<br>/ig,"<br />");g=g.replace(/<style(.*?)style>/gi,"");g=g.replace(/<script(.*?)script>/gi,"");g=g.replace(/<!--(.*?)-->/gi,"");return g}},stripTags:function(l,m){var p="",n=false;var j=[];var d=[];var o="";var g=0;var f="";var h="";var e=function(k,i,q){return q.split(k).join(i)};if(m){d=m.match(/([a-zA-Z0-9]+)/gi)}l+="";j=l.match(/(<\/?[\S][^>]*>)/gi);for(p in j){if(isNaN(p)){continue}h=j[p].toString();n=false;for(f in d){o=d[f];g=-1;if(g!=0){g=h.toLowerCase().indexOf("<"+o+">")}if(g!=0){g=h.toLowerCase().indexOf("<"+o+" ")}if(g!=0){g=h.toLowerCase().indexOf("</"+o)}if(g==0){n=true;break}}if(!n){l=e(h,"",l)}}return l},stripAttr:function(d){return d.replace(/<[^>]*>/g,function(e){if(e.match(/<img[^>]*>/i)){e=e.replace(/ ([^=]+)="[^"]*"/ig,function(g,f){if(f.match(/class|src|title|width|height|align/)){return g}return""})}else{if(e.match(/<span[^>]*>/i)){e=e.replace(/ ([^=]+)="[^"]*"/ig,function(g,f){if(f.match(/style/)){return g}return""})}else{if(e.match(/<a[^>]*>/i)){e=e.replace(/ ([^=]+)="[^"]*"/ig,function(g,f){if(f.match(/href|title|src|target/)){return g}return""})}else{e=e.replace(/ ([^=]+)="[^"]*"/ig,function(g,f){return""})}}}return e})},sha1:function(u){var f=function(z,j){var i=(z<<j)|(z>>>(32-j));return i};var v=function(B){var A="";var z;var j;for(z=7;z>=0;z--){j=(B>>>(z*4))&15;A+=j.toString(16)}return A};var k;var x,w;var e=new Array(80);var o=1732584193;var m=4023233417;var l=2562383102;var h=271733878;var g=3285377520;var t,s,r,q,p;var y;u=this.utf8_encode(u);var d=u.length;var n=[];for(x=0;x<d-3;x+=4){w=u.charCodeAt(x)<<24|u.charCodeAt(x+1)<<16|u.charCodeAt(x+2)<<8|u.charCodeAt(x+3);n.push(w)}switch(d%4){case 0:x=2147483648;break;case 1:x=u.charCodeAt(d-1)<<24|8388608;break;case 2:x=u.charCodeAt(d-2)<<24|u.charCodeAt(d-1)<<16|32768;break;case 3:x=u.charCodeAt(d-3)<<24|u.charCodeAt(d-2)<<16|u.charCodeAt(d-1)<<8|128;break}n.push(x);while((n.length%16)!=14){n.push(0)}n.push(d>>>29);n.push((d<<3)&4294967295);for(k=0;k<n.length;k+=16){for(x=0;x<16;x++){e[x]=n[k+x]}for(x=16;x<=79;x++){e[x]=f(e[x-3]^e[x-8]^e[x-14]^e[x-16],1)}t=o;s=m;r=l;q=h;p=g;for(x=0;x<=19;x++){y=(f(t,5)+((s&r)|(~s&q))+p+e[x]+1518500249)&4294967295;p=q;q=r;r=f(s,30);s=t;t=y}for(x=20;x<=39;x++){y=(f(t,5)+(s^r^q)+p+e[x]+1859775393)&4294967295;p=q;q=r;r=f(s,30);s=t;t=y}for(x=40;x<=59;x++){y=(f(t,5)+((s&r)|(s&q)|(r&q))+p+e[x]+2400959708)&4294967295;p=q;q=r;r=f(s,30);s=t;t=y}for(x=60;x<=79;x++){y=(f(t,5)+(s^r^q)+p+e[x]+3395469782)&4294967295;p=q;q=r;r=f(s,30);s=t;t=y}o=(o+t)&4294967295;m=(m+s)&4294967295;l=(l+r)&4294967295;h=(h+q)&4294967295;g=(g+p)&4294967295}y=v(o)+v(m)+v(l)+v(h)+v(g);return y.toLowerCase()},prefixConstruct:function(d){switch(true){case (d=="scape"):return"S";break;case (d=="reply"):return"R";break;case (d=="photo"):return"P";break;case (d=="comment"):return"C";break}},getIdAndType:function(f){var d;switch(true){case (/S\d/).test(f):d="scape";break;case (/R\d/).test(f):d="reply";break;case (/C\d/).test(f):d="comment";break;case (/L\d/).test(f):d="like";break;case (/D\d/).test(f):d="dislike";break;case (/N\d/).test(f):d="notif";break;case (/W\d/).test(f):d="watch";break;case (/P\d/).test(f):d="photo";break}var e=f.replace(/S|R|C|L|D|N|W|P/,"");return{id:e,idType:d}},emoToText:function(f,d){var e=c.prefixConstruct(d);(b("#"+e+f+" .emoticon.tongue").length>0)?b("#"+e+f+" .emoticon.tongue").replaceWith(":P"):"";(b("#"+e+f+" .emoticon.laugh").length>0)?b("#"+e+f+" .emoticon.laugh").replaceWith(":D"):"";(b("#"+e+f+" .emoticon.smile").length>0)?b("#"+e+f+" .emoticon.smile").replaceWith(":)"):"";(b("#"+e+f+" .emoticon.sad").length>0)?b("#"+e+f+" .emoticon.sad").replaceWith(":("):"";(b("#"+e+f+" .emoticon.cry").length>0)?b("#"+e+f+" .emoticon.cry").replaceWith(":'("):"";(b("#"+e+f+" .emoticon.heart").length>0)?b("#"+e+f+" .emoticon.heart").replaceWith("&lt;3"):"";(b("#"+e+f+" .emoticon.surprised").length>0)?b("#"+e+f+" .emoticon.surprised").replaceWith(":O"):"";(b("#"+e+f+" .emoticon.angel").length>0)?b("#"+e+f+" .emoticon.angel").replaceWith("(a)"):"";(b("#"+e+f+" .emoticon.blush").length>0)?b("#"+e+f+" .emoticon.blush").replaceWith(":$"):"";(b("#"+e+f+" .emoticon.cool").length>0)?b("#"+e+f+" .emoticon.cool").replaceWith("(cool)"):"";(b("#"+e+f+" .emoticon.wink").length>0)?b("#"+e+f+" .emoticon.wink").replaceWith(";)"):"";(b("#"+e+f+" .emoticon.worried").length>0)?b("#"+e+f+" .emoticon.worried").replaceWith(":S"):"";(b("#"+e+f+" .emoticon.speechless").length>0)?b("#"+e+f+" .emoticon.speechless").replaceWith(":|"):"";(b("#"+e+f+" .emoticon.hardLaugh").length>0)?b("#"+e+f+" .emoticon.hardLaugh").replaceWith("(xD)"):"";(b("#"+e+f+" .emoticon.hardLaughTongue").length>0)?b("#"+e+f+" .emoticon.hardLaughTongue").replaceWith("(xP)"):"";(b("#"+e+f+" .emoticon.winkLaugh").length>0)?b("#"+e+f+" .emoticon.winkLaugh").replaceWith(";D"):"";(b("#"+e+f+" .emoticon.winkTongue").length>0)?b("#"+e+f+" .emoticon.winkTongue").replaceWith(";P"):"";(b("#"+e+f+" .emoticon.headBang").length>0)?b("#"+e+f+" .emoticon.headBang").replaceWith("(banghead)"):"";(b("#"+e+f+" .emoticon.nerdy").length>0)?b("#"+e+f+" .emoticon.nerdy").replaceWith("8|"):"";(b("#"+e+f+" .emoticon.angry").length>0)?b("#"+e+f+" .emoticon.angry").replaceWith(":@"):"";(b("#"+e+f+" .emoticon.fail").length>0)?b("#"+e+f+" .emoticon.fail").replaceWith("(fail)"):"";(b("#"+e+f+" .emoticon.fml").length>0)?b("#"+e+f+" .emoticon.fml").replaceWith("(fml)"):"";(b("#"+e+f+" .emoticon.brokenHeart").length>0)?b("#"+e+f+" .emoticon.brokenHeart").replaceWith("&lt;/3"):"";(b("#"+e+f+" .emoticon.sleepy").length>0)?b("#"+e+f+" .emoticon.sleepy").replaceWith("(zzz)"):"";(b("#"+e+f+" .emoticon.blackberry").length>0)?b("#"+e+f+" .emoticon.blackberry").replaceWith("(bb)"):"";(b("#"+e+f+" .emoticon.facebook").length>0)?b("#"+e+f+" .emoticon.facebook").replaceWith("(facebook)"):"";(b("#"+e+f+" .emoticon.youtube").length>0)?b("#"+e+f+" .emoticon.youtube").replaceWith("(youtube)"):"";(b("#"+e+f+" .emoticon.ds").length>0)?b("#"+e+f+" .emoticon.ds").replaceWith("(ds)"):"";(b("#"+e+f+" .emoticon.skype").length>0)?b("#"+e+f+" .emoticon.skype").replaceWith("(skype)"):"";(b("#"+e+f+" .emoticon.twitter").length>0)?b("#"+e+f+" .emoticon.twitter").replaceWith("(twitter)"):"";(b("#"+e+f+" .emoticon.mp3").length>0)?b("#"+e+f+" .emoticon.mp3").replaceWith("(mp3)"):""},textToEmo:function(d){return d.replace(/:P/ig,'<span title=":P" class="emoticon tongue"></span>').replace(/:D/ig,'<span title=":D" class="emoticon laugh"></span>').replace(/:\)/g,'<span title=":)" class="emoticon smile"></span>').replace(/:\(/g,'<span title=":(" class="emoticon sad"></span>').replace(/:'\(/g,'<span title=":\'(" class="emoticon cry"></span>').replace(/&lt;3/g,'<span title="&lt;3" class="emoticon heart"></span>').replace(/:O/g,'<span title=":O" class="emoticon surprised"></span>').replace(/\(a\)/g,'<span title="(a)" class="emoticon angel"></span>').replace(/:$/g,'<span title=":$" class="emoticon blush"></span>').replace(/\(cool\)/g,'<span title="(cool)" class="emoticon cool"></span>').replace(/\B;\)/g,'<span title=";)" class="emoticon wink"></span>').replace(/8\|/g,'<span title="8|" class="emoticon nerdy"></span>').replace(/:S/ig,'<span title=":S" class="emoticon worried"></span>').replace(/:\|/g,'<span title=":|" class="emoticon speechless"></span>').replace(/\(xD\)/g,'<span title="(xD)" class="emoticon hardLaugh"></span>').replace(/\(xP\)/g,'<span title="(xP)" class="emoticon hardLaughTongue"></span>').replace(/\B;D/ig,'<span title=";D" class="emoticon winkLaugh"></span>').replace(/\B;P/ig,'<span title=";P" class="emoticon winkTongue"></span>').replace(/:@/g,'<span title=":@" class="emoticon angry"></span>').replace(/\(fail\)/g,'<span title="(fail)" class="emoticon fail"></span>').replace(/\(banghead\)/g,'<span title="(banghead)" class="emoticon headBang"></span>').replace(/\(fml\)/g,'<span title="(fml)" class="emoticon fml"></span>').replace(/&lt;\/3/g,'<span title="&lt;/3" class="emoticon brokenHeart"></span>').replace(/\(zzz\)/g,'<span title="(zzz)" class="emoticon sleepy"></span>').replace(/\(bb\)/g,'<span title="(bb)" class="emoticon blackberry"></span>').replace(/\(facebook\)/g,'<span title="(facebook)" class="emoticon facebook"></span>').replace(/\(msn\)/g,'<span title="(msn)" class="emoticon msn"></span>').replace(/\(youtube\)/g,'<span title="(youtube)" class="emoticon youtube"></span>').replace(/\(ds\)/g,'<span title="(ds)" class="emoticon ds"></span>').replace(/\(skype\)/g,'<span title="(skype)" class="emoticon skype"></span>').replace(/\(twitter\)/g,'<span title="(twitter)" class="emoticon twitter"></span>').replace(/\(mp3\)/g,'<span title="(mp3)" class="emoticon mp3"></span>')},emoticonTable:function(){b("div.table.emoticons").hide();b("div#insertEmoticonBtn").click(function(){b("div.table.emoticons").toggle()});b("#editor").focus(function(){b("div.table.emoticons").hide()});b("span.emoticon").mouseout(function(d){b("div.emoticonName").html("");b("div.emoticonVal").html("")});b("div.table.emoticons span.emoticon").click(function(d){if(window.scapePublisher){window.scapePublisher.setEditorHTML(window.scapePublisher.getEditorHTML()+" "+b("div.emoticonVal").html())}else{if(window.replyPublisher){window.replyPublisher.setEditorHTML(window.replyPublisher.getEditorHTML()+" "+b("div.emoticonVal").html())}}});b("span.emoticon.wink").hover(function(d){b("div.emoticonName").html("Wink");b("div.emoticonVal").html(";)")});b("span.emoticon.winkLaugh").hover(function(d){b("div.emoticonName").html("Laughing wink");b("div.emoticonVal").html(";D")});b("span.emoticon.winkTongue").hover(function(d){b("div.emoticonName").html("Wink with tongue out");b("div.emoticonVal").html(";P")});b("span.emoticon.cry").hover(function(d){b("div.emoticonName").html("Crying");b("div.emoticonVal").html(":'(")});b("span.emoticon.sad").hover(function(d){b("div.emoticonName").html("Sad");b("div.emoticonVal").html(":(")});b("span.emoticon.angel").hover(function(d){b("div.emoticonName").html("Angel");b("div.emoticonVal").html("(a)")});b("span.emoticon.blush").hover(function(d){b("div.emoticonName").html("Embarassed");b("div.emoticonVal").html(":$")});b("span.emoticon.cool").hover(function(d){b("div.emoticonName").html("Cool");b("div.emoticonVal").html("(cool)")});b("span.emoticon.heart").hover(function(d){b("div.emoticonName").html("Heart");b("div.emoticonVal").html("&lt;3")});b("span.emoticon.brokenHeart").hover(function(d){b("div.emoticonName").html("Broken heart");b("div.emoticonVal").html("&lt;/3")});b("span.emoticon.nerdy").hover(function(d){b("div.emoticonName").html("Nerdy");b("div.emoticonVal").html("8|")});b("span.emoticon.sleepy").hover(function(d){b("div.emoticonName").html("Sleepy");b("div.emoticonVal").html("(zzz)")});b("span.emoticon.surprised").hover(function(d){b("div.emoticonName").html("Surprised");b("div.emoticonVal").html(":O")});b("span.emoticon.smile").hover(function(d){b("div.emoticonName").html("Smiling");b("div.emoticonVal").html(":)")});b("span.emoticon.angry").hover(function(d){b("div.emoticonName").html("Angry");b("div.emoticonVal").html(":@")});b("span.emoticon.speechless").hover(function(d){b("div.emoticonName").html("Speechless");b("div.emoticonVal").html(":|")});b("span.emoticon.laugh").hover(function(d){b("div.emoticonName").html("Laughing");b("div.emoticonVal").html(":D")});b("span.emoticon.ds").hover(function(d){b("div.emoticonName").html("Scapehouse");b("div.emoticonVal").html("(ds)")});b("span.emoticon.facebook").hover(function(d){b("div.emoticonName").html("Facebook");b("div.emoticonVal").html("(facebook)")});b("span.emoticon.msn").hover(function(d){b("div.emoticonName").html("MSN");b("div.emoticonVal").html("(msn)")});b("span.emoticon.tongue").hover(function(d){b("div.emoticonName").html("Tongue out");b("div.emoticonVal").html(":P")});b("span.emoticon.worried").hover(function(d){b("div.emoticonName").html("Confused");b("div.emoticonVal").html(":S")});b("span.emoticon.headBang").hover(function(d){b("div.emoticonName").html("Banging Head");b("div.emoticonVal").html("(banghead)")});b("span.emoticon.skype").hover(function(d){b("div.emoticonName").html("Skype");b("div.emoticonVal").html("(skype)")});b("span.emoticon.twitter").hover(function(d){b("div.emoticonName").html("Twitter");b("div.emoticonVal").html("(twitter)")});b("span.emoticon.hardLaugh").hover(function(d){b("div.emoticonName").html("Hard laugh");b("div.emoticonVal").html("(xD)")});b("span.emoticon.hardLaughTongue").hover(function(d){b("div.emoticonName").html("Hard laugh with tongue out");b("div.emoticonVal").html("(xP)")});b("span.emoticon.youtube").hover(function(d){b("div.emoticonName").html("YouTube");b("div.emoticonVal").html("(youtube)")});b("span.emoticon.blackberry").hover(function(d){b("div.emoticonName").html("BlackBerry");b("div.emoticonVal").html("(bb)")});b("span.emoticon.mp3").hover(function(d){b("div.emoticonName").html("MP3 player");b("div.emoticonVal").html("(mp3)")})}};window.O=c}(jQuery));